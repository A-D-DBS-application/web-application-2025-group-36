{% extends "base.html" %}
{% block content %}

<div style="max-width: 60rem; margin: 0 auto;">

  <div style="margin-bottom: 2rem;">
    <h1>Available Papers</h1>
  </div>

  <form method="get" class="filter-bar" style="margin-bottom: 2rem;">
    <div class="filter-group filter-group-search">
       <input type="text" name="q" placeholder="Search by title, abstract..." value="{{ query }}" class="form-control">
    </div>
    <div class="filter-actions">
       <button type="submit" class="btn btn-primary">Search</button>
       {% if query %}
         <a href="{{ url_for('main.search_papers') }}" class="btn btn-secondary">Clear</a>
       {% endif %}
    </div>
  </form>

  {% if papers %}
    <div style="display: flex; flex-direction: column; gap: 1.5rem;">
      {% for p in papers %}
        <div class="paper-grid-card">
          <div class="paper-card-body">
            
            <h2 style="font-size: 1.5rem; margin-bottom: 0.25rem;">
               <a href="{{ url_for('main.paper_detail', paper_id=p.paper_id) }}" style="text-decoration: none;">
                  {{ p.title }}
               </a>
            </h2>

            {% if p.author %}
              <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 1rem;">
                By {{ p.author.name }}
              </p>
            {% endif %}

            {% if p.abstract %}
              <p class="paper-abstract" style="margin-bottom: 1.5rem;">
                {{ p.abstract }}
              </p>
            {% endif %}

            <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
              
              {% if p.file_path %}
                <a href="{{ url_for('static', filename=p.file_path) }}" target="_blank" class="btn btn-primary">
                   View PDF
                </a>
              {% endif %}

              <a href="{{ url_for('main.paper_detail', paper_id=p.paper_id) }}" class="btn btn-secondary">
                 Details
              </a>

              {% if session.get("user_id") == p.user_id or session.get("user_role") in ["System/Admin"] %}
                 <a href="{{ url_for('main.update_paper', paper_id=p.paper_id) }}" class="btn btn-warning">
                    Edit
                 </a>

                 <form method="POST" action="{{ url_for('main.delete_paper', paper_id=p.paper_id) }}">
                    <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this paper?');">
                      Delete
                    </button>
                 </form>
              {% endif %}
            </div>

          </div>
        </div>
      {% endfor %}
    </div>

  {% else %}
    
    <div style="text-align: center; padding: 4rem; background-color: white; border: 1px dashed var(--border-color); border-radius: 1rem;">
       <p style="color: var(--text-muted); margin-bottom: 1rem;">No papers found matching your search.</p>
       <a href="{{ url_for('main.search_papers') }}" class="btn btn-secondary">View all papers</a>
    </div>

  {% endif %}

</div>

{% endblock %}