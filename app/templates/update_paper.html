{% extends "base.html" %}
{% block content %}

<section class="bg-white rounded-2xl shadow-xl border border-gray-200 p-10">
  <div class="flex items-start justify-between flex-wrap gap-6">
    <div>
      <p class="text-sm uppercase tracking-[0.2em] text-gray-500 mb-2">Edit</p>
      <h1 class="text-3xl font-extrabold text-gray-800">Update your paper</h1>
      <p class="text-gray-600 max-w-2xl mt-2">
        Update your research details below.
      </p>
    </div>
    <a href="{{ url_for('main.dashboard') }}" class="text-accent font-semibold hover:underline">Back to archive →</a>
  </div>

  <form method="post" enctype="multipart/form-data" class="mt-8 grid md:grid-cols-2 gap-8">
    <div class="space-y-6">

      <!-- TITLE -->
      <div>
        <label class="block mb-1 font-semibold">Title</label>
        <input type="text" name="title" required
               value="{{ paper.title }}"
               class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-accent text-black">
      </div>

      <!-- ABSTRACT -->
      <div>
        <label class="block mb-1 font-semibold">Abstract</label>
        <textarea name="abstract" required rows="7"
                  class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-accent text-black">{{ paper.abstract }}</textarea>
      </div>

      <!-- RESEARCH DOMAIN -->
      <div>
        <label class="block mb-1 font-semibold">Research domain</label>
        <select name="research_domain"
                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-accent text-black bg-white">
          {% for d in domains %}
            <option value="{{ d }}" {% if paper.research_domain == d %}selected{% endif %}>{{ d }}</option>
          {% endfor %}
          <option value="Other" {% if paper.research_domain not in domains %}selected{% endif %}>Other</option>
        </select>

        <input type="text" name="custom_domain"
               placeholder="Custom domain (optional)"
               value="{% if paper.research_domain not in domains %}{{ paper.research_domain }}{% endif %}"
               class="w-full mt-2 px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-accent text-black">

        <p class="text-xs text-gray-500 mt-1">
          Choose “Other” and enter your own label here (e.g. Quantum Sensing).
        </p>
      </div>
    </div>

    <div class="space-y-6">

      <!-- EXISTING FACILITY -->
      <div class="bg-gray-50 border border-dashed border-accent/40 rounded-xl p-6">
        <p class="text-sm font-semibold text-gray-700 mb-3">Research facility</p>

        <select name="company_id"
                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-accent text-black bg-white">
          <option value="">-- Choose a research facility (optional) --</option>

          {% for company in companies %}
            <option value="{{ company.company_id }}"
              {% if current_facility and current_facility.company_id == company.company_id %}
                  selected
              {% endif %}
            >
              {{ company.name }}
            </option>
          {% endfor %}
        </select>

        <p class="text-xs text-gray-500 mt-2">
          This is the facility/lab where the research took place.
        </p>
      </div>

      <!-- NEW FACILITY -->
      <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
        <p class="text-sm font-semibold text-gray-700 mb-3">Or add a new research facility</p>
        <div class="space-y-3">
          <input type="text" name="new_company" placeholder="Research facility / Lab name"
                 class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-accent text-black">
          <input type="text" name="new_company_industry" placeholder="Discipline / focus"
                 class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-accent text-black">
        </div>
        <p class="text-xs text-gray-500 mt-2">
          This new facility will be registered and linked automatically.
        </p>
      </div>

      <!-- SUBMIT BUTTON -->
      <button type="submit"
              class="w-full px-6 py-4 bg-accent text-white rounded-xl font-semibold hover:bg-teal-600 transition">
        Update paper
      </button>

    </div>
  </form>
</section>

{% endblock %}
