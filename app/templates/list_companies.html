{% extends "base.html" %}
{% block content %}

<div class="page-header-center">
    <div class="tag tag-accent" style="margin-bottom: 1rem; text-transform: uppercase;">
        Network
    </div>
    <h1>
        Research <span class="text-gradient">Ecosystem</span>
    </h1>
    <p>
        Discover the facilities, universities, and companies driving innovation on REVIEWR.
    </p>

    <div class="search-container">
        <div class="search-icon">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        </div>
        <input type="text" id="companySearch" 
               class="search-input-lg" 
               placeholder="Find a research facility..."
               onkeyup="filterCompanies()">
        <div class="search-shortcut">CTRL+K</div>
    </div>
</div>

{% if companies %}
<div class="features-grid" id="companyGrid">
    
    {% for c in companies %}
    <div class="company-card item-card"> <div class="company-content">
            
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div class="company-logo-box">
                    {{ c.name[:2].upper() }}
                </div>
                
                {% if c.industry %}
                <span class="tag tag-dashed" style="background: white;">
                    {{ c.industry }}
                </span>
                {% endif %}
            </div>

            <div style="flex-grow: 1; margin-bottom: 1.5rem;">
                <h2 class="company-name" style="font-size: 1.25rem; margin-bottom: 0.5rem;">{{ c.name }}</h2>
                    <p class="company-description">
                    Active research partner contributing to the scientific archive.
                    </p>
            </div>

            <div class="company-footer">
                <div class="verified-badge">
                    <span class="verified-dot"></span> Verified
                </div>
                
                <a href="{{ url_for('main.dashboard', company=c.name) }}" class="link-arrow">
                    View Papers <span>‚Üí</span>
                </a>
            </div>
        </div>
    </div>
    {% endfor %}

</div>

<div id="noResults" style="display: none; text-align: center; padding: 5rem 0;">
    <div style="display: inline-block; padding: 1rem; background-color: #f9fafb; border-radius: 50%; margin-bottom: 1rem;">
        <svg style="width: 3rem; height: 3rem; color: #d1d5db;" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
    </div>
    <h3>No facilities found</h3>
    <p>Try searching for a different name.</p>
</div>

{% else %}
<div style="text-align: center; padding: 5rem 0; border: 2px dashed var(--border-color); border-radius: 1.5rem; background-color: white;">
    <div style="font-size: 3rem; margin-bottom: 1rem;">üè¢</div>
    <h3>No Companies Yet</h3>
    <p style="max-width: 30rem; margin: 0 auto 2rem auto;">
        The ecosystem is just getting started. Be the first to register a research facility or company.
    </p>
    {% if session.get('user_role') in ['Admin', 'Founder', 'System/Admin'] %}
        <a href="{{ url_for('main.add_company') }}" class="btn btn-primary">Add Company</a>
    {% endif %}
</div>
{% endif %}

<section class="cta-dark-section">
    <div class="cta-glow" style="top: 0; right: 0; background-color: var(--accent);"></div>
    <div class="cta-glow" style="bottom: 0; left: 0; background-color: #3b82f6;"></div>
    
    <div style="position: relative; z-index: 10; max-width: 40rem; margin: 0 auto;">
        <h2 style="color: white; margin-bottom: 1rem;">Missing a Facility?</h2>
        <p style="color: rgba(255,255,255,0.7); margin-bottom: 2rem;">
            If you are a System Admin or Founder, you can expand our network by registering new research partners.
        </p>
        
        {% if session.get('user_role') in ['Admin', 'Founder', 'System/Admin'] %}
            <a href="{{ url_for('main.add_company') }}" class="btn" style="background-color: white; color: #111827;">
                Register New Facility
            </a>
        {% else %}
            <button disabled class="btn" style="background-color: rgba(255,255,255,0.1); color: rgba(255,255,255,0.5); cursor: not-allowed;">
                Contact Admin to Add
            </button>
        {% endif %}
    </div>
</section>

<script>
    function filterCompanies() {
        const input = document.getElementById('companySearch');
        const filter = input.value.toUpperCase();
        const grid = document.getElementById('companyGrid');
        // Updated class selector to match new HTML
        const cards = grid.getElementsByClassName('item-card');
        const noResults = document.getElementById('noResults');
        let visibleCount = 0;

        for (let i = 0; i < cards.length; i++) {
            const nameElement = cards[i].querySelector('.company-name');
            const txtValue = nameElement.textContent || nameElement.innerText;
            
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                cards[i].style.display = ""; // Show
                visibleCount++;
            } else {
                cards[i].style.display = "none"; // Hide
            }
        }

        // Toggle "No Results" message
        if (visibleCount === 0) {
            noResults.style.display = "block";
        } else {
            noResults.style.display = "none";
        }
    }

    // Focus search on Ctrl+K
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            document.getElementById('companySearch').focus();
        }
    });
</script>

{% endblock %}